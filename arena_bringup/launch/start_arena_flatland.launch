<launch>
    
  <param name="use_sim_time" value="true"/>

  <arg name="local_planner"   default="teb"/> 
  <arg name="rviz_file"       default="nav_LP"/>

  <arg name="noise_mode"      default="0"/>
  <param name="noise_mode" value="$(arg noise_mode)"/>

  <arg name="delay"      default="1"/>
  <param name="delay" value="$(arg delay)"/>

  <arg name="train_mode"      default="false"/>
  <arg name="disable_scenario"    default="true"/>
  <arg name="scenario_file"   default="empty_map.json"/>
  <arg name="reset"   default="true"/>

  <!-- Simulation update -->
  <arg name="step_size" default="0.01"/>
  <arg name="update_rate" default="200"/>
  <param name="step_size" value="$(arg step_size)"/>
  <param name="update_rate" value="$(arg update_rate)"/>

  <!-- DRL action frequency -->
  <arg name="action_frequency" default="10"/>
  <param name="action_frequency" value="$(arg action_frequency)"/>

  <!-- Map parameters -->
  <arg name="map_file"        default="map_empty"/>
  <arg name="map_path"        default="$(find simulator_setup)/maps/$(arg map_file)/map.yaml"/>
  <arg name="world_path"      default="$(find simulator_setup)/maps/$(arg map_file)/map.world.yaml"/>

  <arg name="global_frame_id"   value="map"/>
  <arg name="odom_frame_id"     value="odom"/>
  <arg name="base_frame_id"     value="base_footprint"/>
  
  <arg name="odom_ground_truth" default="/odometry/ground_truth"/>

  <!-- Visualization -->
  <arg name="use_viz"         default="true"/>
  <param name="train_mode"    value="$(arg train_mode)"/>
  <param name="use_viz"       value="$(arg use_viz)"/>


  <!-- <arg name="scan_topic" default="scan"/> default laser topic in flatland -->
  
 <!-- use simulator and rviz-->
  <include file="$(find arena_bringup)/launch/sublaunch/flatland_simulator.launch">
    <arg name="world_path"      value="$(arg world_path)"/>


    <!-- <arg name="update_rate"     default="1000.0"/>
    <arg name="step_size"       default="0.005"/> -->

    <arg name="update_rate"     default="$(arg update_rate)"/>
    <arg name="step_size"       default="$(arg step_size)"/>

    <arg name="show_viz"        default="true"/>

    <arg name="viz_pub_rate"    default="50.0"/>
    <arg name="use_rviz"        default="$(arg use_viz)"/>  
    <arg name="train_mode"      value="$(arg train_mode)"/>
    <arg name="rviz_file"       value="$(arg rviz_file)"/>
  </include>

  <!-- map server-->
  <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_path)">
   <param name="frame_id" value="$(arg global_frame_id)"/>
  </node>
  
  <!-- use fake localization-->
  <include file="$(find arena_bringup)/launch/sublaunch/fake_localization.launch">
    <arg name="global_frame_id"   value="$(arg global_frame_id)"/>
    <arg name="odom_frame_id"     value="$(arg odom_frame_id)"/>
    <arg name="base_frame_id"     value="$(arg base_frame_id)"/>
    <arg name="odom_ground_truth" default="$(arg odom_ground_truth)"/>
  </include>

  <!-- start scan_noise node -->
  <include file="$(find arena_bringup)/launch/sublaunch/scan_process.launch">
  </include>

  <!-- start task_generator node -->
  <include file="$(find arena_bringup)/launch/sublaunch/task_generator.launch" unless="$(arg disable_scenario)">
   <arg name="scenarios_json_path" value="$(find simulator_setup)/scenarios/$(arg scenario_file)"/>
   <arg name="auto_reset" value="$(arg reset)"/>
  </include>
   <include file="$(find arena_bringup)/launch/sublaunch/sensor_sim.launch" unless="$(arg disable_scenario)">
  </include>

  <!-- move_base plan manager: which provide basic global planner and cost map -->
  <include file="$(find arena_bringup)/launch/sublaunch/move_base/move_base_$(arg local_planner).launch"/>
  
  <!-- start time_space plan manager FSM-->
  <!-- <include file="$(find arena_bringup)/launch/sublaunch/timed_space_planner_fsm.launch"/> -->
</launch>
